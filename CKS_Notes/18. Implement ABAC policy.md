## ğŸ” ğŸ”§ **Configurer `kubectl` avec un ServiceAccount personnalisÃ© (ex: `john`)**

---

### âœ… **Ã‰tape 0 : CrÃ©er le ServiceAccount et lui donner des droits**

```bash
kubectl create serviceaccount john
kubectl create clusterrolebinding john-full-access \
  --clusterrole=cluster-admin \
  --serviceaccount=default:john
```

ğŸ“ Ici, on donne Ã  `john` un accÃ¨s complet au cluster (âš ï¸ pour test uniquement !).

---

### âœ… **Ã‰tape 1 : RÃ©cupÃ©rer le token du ServiceAccount**

Sur les versions rÃ©centes de Kubernetes (v1.24+), les tokens ne sont plus gÃ©nÃ©rÃ©s automatiquement.

On doit crÃ©er manuellement un **Secret de type `kubernetes.io/service-account-token`** liÃ© Ã  `john` :

```bash
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: john-secret
  annotations:
    kubernetes.io/service-account.name: "john"
type: kubernetes.io/service-account-token
EOF
```

â³ Attendre quelques secondes que le token soit gÃ©nÃ©rÃ© (le `kubernetes` controller le fait automatiquement).

---

### âœ… **Ã‰tape 2 : Extraire le token**

```bash
kubectl get secret john-secret -o jsonpath='{.data.token}' | base64 -d > john-token.txt
export SA_TOKEN=$(cat john-token.txt)
```

---

### âœ… **Ã‰tape 3 : Ajouter l'utilisateur dans `kubectl config`**

```bash
kubectl config set-credentials john --token=$SA_TOKEN
```

---

### âœ… **Ã‰tape 4 : CrÃ©er un contexte avec cet utilisateur**

```bash
kubectl config set-context john-context \
  --cluster=kubernetes \
  --namespace=default \
  --user=john
```

---

### âœ… **Ã‰tape 5 : Utiliser le nouveau contexte**

```bash
kubectl config use-context john-context
```

---

## ğŸ” VÃ©rification

Teste une commande :

```bash
kubectl get pods
```

Tu es maintenant connectÃ© avec le compte `john` !