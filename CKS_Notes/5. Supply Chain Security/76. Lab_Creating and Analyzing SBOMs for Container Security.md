# ðŸ§ª **Lab: Creating and Analyzing SBOMs for Container Security**

---

## ðŸ”° Introduction to SBOM and Supply Chain Security

A **Software Bill of Materials (SBOM)** is a machine-readable list detailing every software componentâ€”libraries, dependencies, modulesâ€”used in a piece of software.

### ðŸ›¡ï¸ Why SBOMs Matter:
- **Transparency**: Know exactly whatâ€™s in your code.
- **Security**: Quickly identify components with known vulnerabilities.
- **Compliance**: Track open source licenses and intellectual property.
- **Incident Response**: Accelerate triage and patching in case of security alerts.

---

## âœ… Step 1: Install the `Syft` Tool

### ðŸŽ¯ Objective:
Download and install **Syft**, a CLI tool for generating SBOMs.

### ðŸ§ª Instructions:
Run the following command to install Syft and place it in `/usr/local/bin`:

```bash
curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin
```

### ðŸ” Check Installation:
```bash
syft version
```

You should see the current version displayed.

---

## âœ… Step 2: Generate an SBOM in SPDX Format

### ðŸŽ¯ Objective:
Generate an SBOM in the **SPDX** format from a Docker image.

### ðŸ§ª Instructions:
```bash
syft docker.io/kodekloud/webapp-color:latest -o spdx > /root/webapp-spdx.sbom
```

### ðŸ“¦ Output Includes:
- Number of packages, executables
- File metadata and digests
- SPDX-compliant SBOM stored in `/root/webapp-spdx.sbom`

---

## âœ… Step 3: Generate an SBOM in CycloneDX (JSON) Format

### ðŸŽ¯ Objective:
Produce the same SBOM using the **CycloneDX** JSON format.

### ðŸ§ª Instructions:
```bash
syft docker.io/kodekloud/webapp-color:latest -o cyclonedx-json > /root/webapp-sbom.json
```

### ðŸ“˜ Notes:
- CycloneDX is a widely adopted SBOM format for security automation tools.
- File will be stored in `/root/webapp-sbom.json`.

---

## âœ… Step 4: Install the `Grype` Tool

### ðŸŽ¯ Objective:
Install **Grype**, a vulnerability scanner for SBOMs and container images.

### ðŸ§ª Instructions:
```bash
curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin
```

### ðŸ” Check Installation:
```bash
grype version
```

---

## âœ… Step 5: Analyze the SBOM with Grype

### ðŸŽ¯ Objective:
Scan the CycloneDX SBOM with Grype to detect known vulnerabilities.

### ðŸ§ª Instructions:
```bash
grype sbom:/root/webapp-sbom.json -o json > /root/grype-report.json
```

### âœ… Result:
- A detailed vulnerability report in JSON format is saved as `/root/grype-report.json`.

### ðŸ“Š Example Summary:
```
166 vulnerability matches found
- 20 Critical
- 81 High
- 58 Medium
- 7 Low
- 0 Negligible
```

---

## âœ… Step 6: Count the Number of Critical Vulnerabilities

### ðŸŽ¯ Objective:
Use `jq` to extract and count critical severity issues from the JSON report.

### ðŸ§ª Command:
```bash
jq -r '[.matches[] | select(.vulnerability.severity == "Critical")] | length' /root/grype-report.json
```

### âœ… Expected Output:
```
20
```

---

## âœ… Step 7: Determine Severity of Specific CVE (CVE-2022-48174)

### ðŸŽ¯ Objective:
Find the **severity level** of a specific CVE within the report.

### ðŸ§ª Command:
```bash
jq -r '.matches[] | select(.vulnerability.id == "CVE-2022-48174") | .vulnerability.severity' /root/grype-report.json
```

### âœ… Expected Output:
```
Critical
```

---

## âœ… Step 8: Investigate a CVEâ€™s Description (CVE-2018-1000517 in BusyBox wget)

### ðŸŽ¯ Objective:
Understand the **type of security issue** caused by this vulnerability.

### ðŸ§ª Command:
```bash
jq -e '.matches[] | select(.vulnerability.id == "CVE-2018-1000517") | .vulnerability.description' /root/grype-report.json
```

### ðŸ“Œ Description Summary:
- **Component**: `BusyBox wget`
- **Issue**: Heap buffer overflow
- **Attack Vector**: Exploitable over network
- **Fixed In**: Commit `8e2174e9bd836e53...`
- **Impact**: Can lead to Denial of Service (DoS) or arbitrary code execution.

---

## âœ… Bonus: Use Less for Manual Review

```bash
less /root/grype-report.json
```

Use `/CVE-2018-1000517` or `/Critical` to search inside the file.

---

## ðŸŽ“ Lab Summary

| Task | Tool | Output |
|------|------|--------|
| Generate SBOM (SPDX) | `Syft` | `/root/webapp-spdx.sbom` |
| Generate SBOM (CycloneDX) | `Syft` | `/root/webapp-sbom.json` |
| Scan SBOM | `Grype` | `/root/grype-report.json` |
| Count Critical CVEs | `jq` | `20` |
| CVE Severity Lookup | `jq` | `"Critical"` |
| CVE Detail Lookup | `jq` | Heap buffer overflow |
