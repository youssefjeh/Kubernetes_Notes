# Admission Controllers 

Les **Admission Controllers** sont des modules de lâ€™API Server qui interceptent les requÃªtes envoyÃ©es Ã  lâ€™API Kubernetes avant quâ€™elles ne soient enregistrÃ©es. Ils permettent dâ€™**appliquer des rÃ¨gles de validation ou dâ€™ajustement automatique** des objets.

---

## âš™ï¸ Activer ou dÃ©sactiver un Admission Controller

Les Admission Controllers sont activÃ©s ou dÃ©sactivÃ©s via les **paramÃ¨tres de dÃ©marrage** du `kube-apiserver`.

Exemple dâ€™activation :

```bash
--enable-admission-plugins=NodeRestriction,NamespaceAutoProvision
--disable-admission-plugins=DefaultStorageClass
````

> ğŸ”§ Ces options sont gÃ©nÃ©ralement dÃ©finies dans le fichier manifeste du pod `kube-apiserver`, situÃ© dans :
>
> `/etc/kubernetes/manifests/kube-apiserver.yaml`

---

## ğŸ” VÃ©rifier les plugins activÃ©s sur le cluster

### Depuis la CLI (si `kube-apiserver` est un pod) :

```bash
kubectl -n kube-system exec kube-apiserver-controlplane -- \
  kube-apiserver -h | grep enable-admission-plugins
```

### Ou en observant le processus systÃ¨me :

```bash
ps -ef | grep kube-apiserver | grep admission-plugins
```

---

## ğŸ§ª Exemple : `NamespaceAutoProvision`

### Cas 1 : Plugin dÃ©sactivÃ©

```bash
kubectl run nginx --image nginx -n blue
# âœ Error from server (NotFound): namespaces "blue" not found
```

> Cela signifie que `NamespaceAutoProvision` est **dÃ©sactivÃ©**, donc Kubernetes ne crÃ©e pas automatiquement le namespace.

---

### Cas 2 : Plugin activÃ©

En ajoutant lâ€™option suivante dans `kube-apiserver.yaml` :

```yaml
--enable-admission-plugins=NodeRestriction,NamespaceAutoProvision
```

Puis aprÃ¨s redÃ©marrage automatique du pod :

```bash
kubectl run nginx --image nginx -n blue
# âœ pod/nginx created
```

âœ… Le namespace `blue` a Ã©tÃ© automatiquement crÃ©Ã©, car `NamespaceAutoProvision` est activÃ©.

---

## ğŸ” Ã€ propos de `NamespaceLifecycle`

Le plugin `NamespaceLifecycle` est **essentiel** dans tout cluster Kubernetes. Il :

* EmpÃªche la crÃ©ation de ressources dans des namespaces inexistants (si `NamespaceAutoProvision` est dÃ©sactivÃ©)
* ProtÃ¨ge les namespaces critiques (`default`, `kube-system`, `kube-public`) contre la suppression

> ğŸ” **Remplace les anciens plugins** `NamespaceExists` et `NamespaceAutoProvision` (qui sont dÃ©sormais dÃ©prÃ©ciÃ©s dans les versions rÃ©centes de Kubernetes).

---

## âœ… RÃ©sumÃ©

| Admission Controller     | RÃ´le                                                               |
| ------------------------ | ------------------------------------------------------------------ |
| `NamespaceLifecycle`     | Refuse les requÃªtes vers des namespaces inexistants ou protÃ©gÃ©s    |
| `NamespaceAutoProvision` | CrÃ©e automatiquement un namespace sâ€™il nâ€™existe pas                |
| `NodeRestriction`        | Restreint les actions que les kubelets peuvent faire sur les nodes |
