## ğŸ§± **Architecture du Container Runtime**

Quand tu exÃ©cutes une commande comme :

```bash
docker run -d nginx
```

Voici ce qui se passe **Ã©tape par Ã©tape** :

---

### 1. **Docker CLI (Interface en ligne de commande)**

* Lâ€™utilisateur tape une commande Docker (`docker run`, etc.).
* Cette commande est transmise Ã  la couche suivante via une **API REST**.

---

### 2. **REST API**

* Sert de **point dâ€™entrÃ©e** pour interagir avec Docker de faÃ§on programmatique.
* Transmet la commande au **Docker Daemon**.

---

### 3. **Docker Daemon (`dockerd`)**

* Câ€™est le **cerveau de Docker**.
* Il gÃ¨re les images, les volumes, les rÃ©seaux, et coordonne lâ€™exÃ©cution des conteneurs.
* Il communique avec **containerd** pour la gestion bas-niveau des conteneurs.

---

### 4. **containerd**

* Un **runtime de conteneurs** de niveau intermÃ©diaire.
* Il gÃ¨re :

  * le cycle de vie des conteneurs,
  * la distribution des images,
  * les snapshots,
  * la gestion rÃ©seau.

---

### 5. **containerd-shim**

* Permet Ã  un conteneur de **vivre indÃ©pendamment** du daemon Docker/containerd.
* Il garde le conteneur actif mÃªme si le Docker daemon est redÃ©marrÃ©.
* Fournit lâ€™isolation du processus du conteneur.

---

### 6. **runC**

* Câ€™est le **runtime dâ€™exÃ©cution conforme OCI** (Open Container Initiative).
* Il lance **le vrai processus du conteneur**.
* Interagit avec le noyau Linux via :

  * **cgroups** : contrÃ´le des ressources (CPU, mÃ©moire, etc.),
  * **namespaces** : isolation du systÃ¨me de fichiers, PID, rÃ©seau, etc.

---

## ğŸ” **Alternatives Ã  runC : runtimes sÃ©curisÃ©s**

Docker permet d'utiliser **d'autres runtimes** Ã  la place de runC pour plus de sÃ©curitÃ© :

### 1. **Kata Containers (`kata-runtime`)**

* Utilise des **machines virtuelles lÃ©gÃ¨res** pour lancer les conteneurs.
* Offre une **isolation forte** (quasi-VM) tout en gardant une bonne performance.

```bash
docker run --runtime kata -d nginx
```

---

### 2. **gVisor (`runsc`)**

* Runtime dÃ©veloppÃ© par Google.
* **Intercepte les appels systÃ¨me** du conteneur et les traite dans un espace utilisateur sÃ©curisÃ©.
* Offre une **sÃ©curitÃ© renforcÃ©e** sans VM complÃ¨te.

```bash
docker run --runtime runsc -d nginx
```

---

## ğŸ§­ **SchÃ©ma hiÃ©rarchique rÃ©sumÃ©**

```
docker run -d nginx
       â†“
Docker CLI
       â†“
REST API
       â†“
Docker Daemon
       â†“
containerd
       â†“
containerd-shim
       â†“
runC (ou kata-runtime / runsc)
       â†“
Linux Kernel (cgroups, namespaces)
```