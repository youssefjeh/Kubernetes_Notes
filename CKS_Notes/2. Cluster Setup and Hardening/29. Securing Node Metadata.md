# ğŸ›¡ï¸ Understanding & Securing Kubernetes Node Metadata

## ğŸ§  Quâ€™est-ce que les *Node Metadata* ?

Les **mÃ©tadonnÃ©es des nÅ“uds** (Node Metadata) sont des informations exposÃ©es par le plan de contrÃ´le Kubernetes Ã  propos de chaque nÅ“ud du cluster. Ces donnÃ©es incluent :

- Version du kubelet
- Adresse IP interne/externe
- Version du noyau Linux
- Labels, taints, et capacitÃ©s du nÅ“ud
- Informations sur lâ€™OS, le container runtime, etc.

Ces mÃ©tadonnÃ©es peuvent Ãªtre consultÃ©es via la commande suivante :

```bash
kubectl get nodes -o json
```

---

## âš ï¸ Pourquoi sÃ©curiser les Node Metadata ?

### ğŸ”“ 1. PrÃ©venir lâ€™accÃ¨s non autorisÃ©

Les informations sur la version de kubelet peuvent Ãªtre exploitÃ©es pour lancer des attaques spÃ©cifiques Ã  cette version.

**Exemple** :

```bash
kubectl get nodes -o jsonpath='{.items[*].status.nodeInfo.kubeletVersion}'
```

â¡ï¸ Un attaquant pourrait :
- Identifier une version vulnÃ©rable.
- Rechercher des CVEs connues.
- Exploiter une faille spÃ©cifique.

---

### âš ï¸ 2. Ã‰viter les erreurs de configuration (Misconfiguration)

Un utilisateur non expÃ©rimentÃ© peut par erreur modifier des taints critiques, ce qui peut dÃ©sÃ©quilibrer le scheduling des pods.

**Exemple dangereux** :

```bash
kubectl taint nodes node-1 key=value:NoSchedule-
```

â¡ï¸ ConsÃ©quences possibles :
- Des workloads non autorisÃ©s s'exÃ©cutent sur un nÅ“ud de production.
- Cela peut provoquer une contention de ressources ou des interruptions de service.

---

### ğŸ” 3. Maintenir la confidentialitÃ© du rÃ©seau

Les adresses IP internes des nÅ“uds peuvent Ãªtre rÃ©vÃ©lÃ©es, exposant la topologie du rÃ©seau privÃ©.

**Exemple dâ€™extraction des IPs internes** :

```bash
kubectl get nodes -o jsonpath='{.items[*].status.addresses[?(@.type=="InternalIP")].address}'
```

â¡ï¸ Un attaquant peut :
- Cartographier le rÃ©seau interne.
- Lancer des attaques ciblÃ©es (ex. : DDoS interne, scans, rebonds SSH, etc.).

---

### âœ… 4. Assurer la conformitÃ© rÃ©glementaire

RÃ©vÃ©ler la version du noyau Linux de vos nÅ“uds peut Ãªtre une violation des exigences de conformitÃ©.

**Exemple** :

```bash
kubectl get nodes -o jsonpath='{.items[*].status.nodeInfo.kernelVersion}'
```

â¡ï¸ Risques :
- Violation de la conformitÃ© avec des normes comme **HIPAA**, **GDPR**, **PCI-DSS**.
- Facilitation de l'exploitation de vulnÃ©rabilitÃ©s non corrigÃ©es.

---

## ğŸ›¡ï¸ StratÃ©gies de Protection des MÃ©tadonnÃ©es des NÅ“uds

### ğŸ” 1. RBAC (Role-Based Access Control)

- Restreindre l'accÃ¨s aux informations des nÅ“uds Ã  des rÃ´les spÃ©cifiques.
- Exemple : Interdire `get nodes` aux utilisateurs standards.

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: readonly-nodes
rules:
- apiGroups: [""]
  resources: ["nodes"]
  verbs: ["get", "list"]
```

Utilisez aussi des **ClusterRoles** et **RoleBindings** adaptÃ©s.

---

### ğŸŒ 2. Isolation des NÅ“uds

- SÃ©parer les nÅ“uds de production, de test et de dÃ©veloppement.
- Utiliser des taints et labels pour contrÃ´ler le scheduling des pods.

---

### ğŸ•¸ï¸ 3. Network Policies

- Limiter le trafic rÃ©seau entre les pods et les nÅ“uds.
- Ã‰viter quâ€™un pod compromis accÃ¨de Ã  lâ€™API ou Ã  d'autres nÅ“uds.

---

### ğŸ“‹ 4. Audit Logs

- Activer la journalisation des accÃ¨s API Kubernetes.
- Surveiller les tentatives dâ€™accÃ¨s aux ressources sensibles (`nodes`, `pods`, etc.).

---

### ğŸ”„ 5. Mises Ã  jour et correctifs

- Maintenir Ã  jour :
  - Le kubelet
  - Le noyau Linux
  - Les outils CLI
- Corriger rapidement les vulnÃ©rabilitÃ©s connues.

---

## âœ… En rÃ©sumÃ©

| Risque                          | ConsÃ©quence potentielle                      | Solution recommandÃ©e          |
|-------------------------------|---------------------------------------------|-------------------------------|
| AccÃ¨s Ã  la version du kubelet | Attaque ciblÃ©e                              | RBAC + mises Ã  jour           |
| Suppression de taints         | Scheduling non contrÃ´lÃ©                     | RBAC + isolation              |
| IPs internes exposÃ©es         | Cartographie rÃ©seau pour attaques ciblÃ©es   | Network Policies              |
| Version du kernel visible     | Perte de conformitÃ©                         | RBAC + hardening              |
