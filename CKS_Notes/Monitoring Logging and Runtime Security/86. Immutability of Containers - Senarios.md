## âœ… 1. **EmpÃªcher lâ€™Ã©criture dans le conteneur**

### ğŸ¯ Objectif :

EmpÃªcher toute modification de fichiers dans le systÃ¨me du conteneur.

### âœ… Solution :

Utiliser `readOnlyRootFilesystem: true`.

### ğŸ“„ Exemple YAML :

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: readonly-demo
spec:
  containers:
  - name: app
    image: nginx
    securityContext:
      readOnlyRootFilesystem: true
```

---

## âœ… 2. **Ne pas inclure de shell dans lâ€™image (ex: `sh`, `bash`)**

### ğŸ¯ Objectif :

EmpÃªcher quâ€™un attaquant ouvre un terminal dans le conteneur (`kubectl exec` ou autre).

### âœ… Solution :

* Utiliser des images **minimalistes** comme `distroless`, `scratch`, `alpine` sans shell.
* Ne pas installer `bash`, `sh`, etc.

### ğŸ“„ Exemple :

```yaml
containers:
- name: app
  image: gcr.io/distroless/static  # Pas de shell du tout
```

---

## âœ… 3. **Utiliser une image propre et vÃ©rifiÃ©e**

### ğŸ¯ Objectif :

Ã‰viter de lancer une image dÃ©jÃ  compromise.

### âœ… Solution :

* Scanner les images avec **Trivy, Clair, Grype**, etc.
* Signer les images avec **cosign** ou utiliser **imagePolicyWebhook**.
* Utiliser **imagePullPolicy: Always** pour forcer lâ€™image la plus rÃ©cente (si non taggÃ©e avec hash).

### ğŸ“„ Exemple :

```yaml
containers:
- name: app
  image: myregistry.com/myapp@sha256:<digest>  # Utilisation dâ€™un hash (immuable)
  imagePullPolicy: Always
```

---

## âœ… 4. **Pas de montage de volumes sensibles en Ã©criture**

### ğŸ¯ Objectif :

EmpÃªcher que le conteneur ait accÃ¨s Ã  des fichiers systÃ¨me ou secrets en Ã©criture.

### âœ… Solution :

* Monter les volumes en **readOnly: true** si possible.
* Ã‰viter de monter `/etc`, `/var/run` ou `/proc` en Ã©criture.

### ğŸ“„ Exemple :

```yaml
volumes:
- name: config
  configMap:
    name: my-config
containers:
- name: app
  image: myapp
  volumeMounts:
  - mountPath: /etc/config
    name: config
    readOnly: true
```

---

## âœ… 5. **Ã‰viter les permissions root**

### ğŸ¯ Objectif :

Limiter les capacitÃ©s si un attaquant entre quand mÃªme.

### âœ… Solution :

* Ne pas utiliser l'utilisateur root.
* DÃ©finir un `runAsUser` non privilÃ©giÃ©.

### ğŸ“„ Exemple :

```yaml
securityContext:
  runAsUser: 1000
  runAsNonRoot: true
  allowPrivilegeEscalation: false
```

---

## âœ… 6. **Ã‰viter les capacitÃ©s Linux dangereuses**

### ğŸ¯ Objectif :

RÃ©duire les capacitÃ©s du conteneur Ã  lâ€™essentiel.

### âœ… Solution :

* Supprimer les capacitÃ©s inutiles (ex: `NET_ADMIN`, `SYS_ADMIN`).

### ğŸ“„ Exemple :

```yaml
securityContext:
  capabilities:
    drop:
    - ALL
```

---

## âœ… 7. **DÃ©sactiver exec et attach (optionnel avancÃ©)**

### ğŸ¯ Objectif :

EmpÃªcher quâ€™on exÃ©cute un shell Ã  lâ€™intÃ©rieur dâ€™un conteneur via `kubectl exec`.

### âœ… Solution :

Utiliser une **Admission Controller** ou une **Policy (OPA/Gatekeeper)** pour bloquer `exec`.

> âš ï¸ Ce nâ€™est pas natif dans le YAML des pods.

---

## âœ… 8. **Utiliser un Admission Controller (OPA, Kyverno, Gatekeeper)**

### ğŸ¯ Objectif :

Appliquer des rÃ¨gles strictes comme lâ€™obligation du `readOnlyRootFilesystem`, interdiction du root, etc.

### âœ… Exemple Kyverno :

```yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: enforce-readonly
spec:
  validationFailureAction: enforce
  rules:
  - name: require-readonly-rootfs
    match:
      resources:
        kinds:
        - Pod
    validate:
      message: "Root filesystem must be read-only"
      pattern:
        spec:
          containers:
          - securityContext:
              readOnlyRootFilesystem: true
```

---

## ğŸ“Œ RÃ©sumÃ© des scÃ©narios

| ğŸ§© ScÃ©nario                          | ğŸ” But                      | ğŸ› ï¸ Solution                     |
| ------------------------------------ | --------------------------- | -------------------------------- |
| SystÃ¨me de fichiers en lecture seule | EmpÃªcher modifications      | `readOnlyRootFilesystem: true`   |
| Pas de shell                         | Pas d'accÃ¨s interactif      | Image minimaliste (`distroless`) |
| Image propre                         | Pas d'image infectÃ©e        | Scanner / signer / hash          |
| Volumes en lecture seule             | Pas de fichiers modifiables | `readOnly: true`                 |
| Pas dâ€™utilisateur root               | Limiter les privilÃ¨ges      | `runAsNonRoot: true`             |
| Supprimer les capacitÃ©s Linux        | Moins de surface d'attaque  | `capabilities.drop: ALL`         |
| Bloquer `exec`                       | Pas dâ€™accÃ¨s Ã  lâ€™intÃ©rieur   | Admission controller             |
| Politique obligatoire                | VÃ©rification automatique    | Kyverno / OPA / Gatekeeper       |