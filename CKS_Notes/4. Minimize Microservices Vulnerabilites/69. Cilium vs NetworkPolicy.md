## üéØ Objectif :

Tu veux comprendre :

* Quelle est la **diff√©rence entre `NetworkPolicy` (Kubernetes)** et **`CiliumNetworkPolicy` (Cilium)**,
* Avec un **exemple basique et tr√®s clair**.

---

## üì¶ Sc√©nario de base : 2 applications qui communiquent

Imaginons qu'on a ces 2 pods dans Kubernetes :

| Pod        | Namespace | Label   | R√¥le    |
| ---------- | --------- | ------- | ------- |
| `frontend` | `default` | app=web | Client  |
| `backend`  | `default` | app=api | Serveur |

üëâ Le **frontend veut appeler le backend** (via HTTP par exemple).

---

## üõ°Ô∏è Cas 1 ‚Äì Avec une **NetworkPolicy standard de Kubernetes**

```yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend
  namespace: default
spec:
  podSelector:
    matchLabels:
      app: api       # cible = backend
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: web   # autoris√© = frontend
```

### ‚úÖ Que fait-elle ?

* Elle autorise **les pods avec `app=web` √† parler √† `app=api`**.
* Tout le reste est **bloqu√©**.

### ‚ùå Limitations :

* Pas de filtre par protocole (HTTP, DNS, etc.)
* Pas de support pour le **chiffrement du trafic**
* Pas de contr√¥le fin sur les ports ou chemins HTTP
* Impossible de faire du **logging r√©seau d√©taill√©**

---

## üõ°Ô∏è Cas 2 ‚Äì Avec une **CiliumNetworkPolicy**

```yaml
apiVersion: cilium.io/v2
kind: CiliumNetworkPolicy
metadata:
  name: allow-web-to-api
  namespace: default
spec:
  endpointSelector:
    matchLabels:
      app: api
  ingress:
    - fromEndpoints:
        - matchLabels:
            app: web
    - toPorts:
        - ports:
            - port: "80"
              protocol: TCP
          rules:
            http:
              - method: GET
                path: /api/data
```

### ‚úÖ Que fait-elle ?

* Autorise les pods avec `app=web` √† acc√©der √† :

  * `app=api`,
  * **via HTTP GET uniquement**,
  * **sur le port 80**,
  * **et seulement au chemin `/api/data`**.

### üí• Avantages :

* Cilium comprend le **niveau applicatif** (HTTP),
* Tu peux faire du filtrage pr√©cis : m√©thode HTTP, chemin, en-t√™te,
* Tu peux activer le **chiffrement automatique (mTLS, IPsec, WireGuard)**,
* Tu peux **observer ou tracer le trafic avec Hubble**.

---

## üß† R√©sum√© clair :

| Fonction                            | `NetworkPolicy` (K8s natif) | `CiliumNetworkPolicy` |
| ----------------------------------- | --------------------------- | --------------------- |
| S√©curit√© basique L3/L4 (IP/port)    | ‚úÖ                           | ‚úÖ                     |
| S√©curit√© L7 (HTTP, DNS, gRPC)       | ‚ùå                           | ‚úÖ                     |
| Chiffrement du trafic (mTLS, IPsec) | ‚ùå                           | ‚úÖ                     |
| Logging / observabilit√© r√©seau      | ‚ùå                           | ‚úÖ (avec Hubble)       |
| Performance                         | Moyenne (iptables)          | Excellente (eBPF)     |
| Expressivit√©                        | Simple                      | Tr√®s puissante        |

---

## üß™ Conclusion simple

| Tu veux‚Ä¶                                          | Tu choisis‚Ä¶           |
| ------------------------------------------------- | --------------------- |
| Juste filtrer par IP/port                         | `NetworkPolicy`       |
| Contr√¥ler finement HTTP, chiffrer, observer, etc. | `CiliumNetworkPolicy` |