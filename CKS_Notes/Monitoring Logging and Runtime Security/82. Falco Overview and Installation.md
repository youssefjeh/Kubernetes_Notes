## üéØ **Falco : Qu‚Äôest-ce que c‚Äôest ?**

Falco est un outil de **d√©tection d‚Äôintrusions** (IDS) en temps r√©el pour **Linux et Kubernetes**.
Il surveille ce qui se passe sur le syst√®me (processus, fichiers, r√©seaux‚Ä¶) en observant les **syscalls** (appels syst√®me) et d√©clenche des **alertes** en cas de comportement suspect.

---

## üß± **Architecture compl√®te de Falco**

### üìä Vue g√©n√©rale (simplifi√©e) :

```
+----------------+        +------------------+       +---------------+
|  Application   |        |  User Space      |       | Kernel Space  |
+----------------+        +------------------+       +---------------+
        ‚îÇ                          ‚îÇ                          ‚îÇ
        ‚ñº                          ‚ñº                          ‚ñº
  Application g√©n√®re       ‚óÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Syscalls ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂
   des activit√©s            (ex: open, read, exec...)

                            +------------------------------+
                            | Falco (core engine)          |
                            |                              |
                            | - Policy Engine              |
                            | - Falco Rules                |
                            +------------------------------+
                                    ‚ñ≤
                                    ‚îÇ
                                    ‚ñº
                            +------------------------------+
                            | Falco Kernel Module ou eBPF  |
                            +------------------------------+
                                    ‚ñ≤
                                    ‚îÇ
                                    ‚ñº
                            +------------------------------+
                            | Syscall interception layer    |
                            | (captur√© via kernel)          |
                            +------------------------------+
```

---

## üìå R√¥les des composants (selon ta liste) :

| **Composant**           | **R√¥le**                                                                                                                                                      |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Application**         | Programme ou container qui s'ex√©cute sur le syst√®me. Il fait des actions (ouvrir des fichiers, lancer des commandes, etc).                                    |
| **syscall()**           | Appel syst√®me utilis√© par l‚Äôapplication pour interagir avec le noyau (ex: lire un fichier).                                                                   |
| **Kernel Space**        | Partie du syst√®me d‚Äôexploitation qui g√®re les ressources syst√®me. Les syscalls passent ici.                                                                   |
| **User Space**          | Espace o√π tournent les applications utilisateur et Falco lui-m√™me.                                                                                            |
| **Falco Kernel Module** | Module ins√©r√© dans le noyau pour intercepter tous les syscalls en temps r√©el. ‚ö†Ô∏è N√©cessite des acc√®s root.                                                    |
| **eBPF**                | Alternative plus moderne et s√©curis√©e au kernel module. Permet de **capturer les syscalls** sans modifier le noyau. Utilis√© par d√©faut dans Kubernetes/cloud. |
| **Libraries**           | Biblioth√®ques utilis√©es pour communiquer entre eBPF/kernel module et le moteur de Falco.                                                                      |
| **Falco**               | Le moteur principal qui re√ßoit les √©v√©nements, applique les r√®gles, et d√©clenche les alertes.                                                                 |
| **Policy Engine**       | Partie de Falco qui applique les **r√®gles** pour d√©cider si un comportement est suspect.                                                                      |
| **Falco Rules**         | Les **r√®gles de d√©tection** : par exemple, ‚Äúsi un shell s‚Äôouvre dans un container => alerte‚Äù.                                                                 |
| **Output**              | Ce que fait Falco quand une r√®gle est viol√©e : log, alerte, webhook, etc.                                                                                     |

---

## üîÑ **Comment tout √ßa fonctionne ensemble (√©tapes)**

1. ‚úÖ Une **application s‚Äôex√©cute** (par ex: dans un container Kubernetes).
2. üìû Elle fait des **syscalls** pour interagir avec le syst√®me (ouvrir fichiers, cr√©er des processus, etc).
3. üëÇ Le **kernel module** ou **eBPF** intercepte ces syscalls.
4. üì§ Les √©v√©nements sont envoy√©s √† **Falco** via des biblioth√®ques.
5. üß† Le **policy engine** de Falco applique les **r√®gles** pour d√©tecter si le comportement est anormal.
6. üö® Si une r√®gle est viol√©e, **Falco d√©clenche une alerte** (console, Slack, syslog‚Ä¶).
7. üë®‚Äçüíª L‚Äôadmin peut alors **r√©agir** (manuellement ou automatiquement via des outils comme Falcosidekick).

---

## üß† Exemple de r√®gle Falco :

```yaml
- rule: Shell in container
  desc: Detect a shell running inside a container
  condition: container.id != host and proc.name in (bash, sh, zsh)
  output: "Shell spawned in container (user=%user.name command=%proc.cmdline)"
  priority: WARNING
```

> Si un `bash` ou `sh` est lanc√© dans un container ‚Üí Falco d√©clenche une alerte.

---

## üß∞ En r√©sum√© (pratique pour CKS) :

| √âl√©ment           | Tu dois savoir...                                                 |
| ----------------- | ----------------------------------------------------------------- |
| **eBPF**          | M√©thode moderne de collecte des √©v√©nements                        |
| **Falco Rules**   | D√©crivent ce qui est "normal" ou "dangereux"                      |
| **Falco Engine**  | Applique les r√®gles sur les √©v√©nements                            |
| **Falcosidekick** | (Optionnel) pour envoyer les alertes ailleurs (Slack, Webhook...) |