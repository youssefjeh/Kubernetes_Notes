# ğŸ”§ Docker Daemon Configuration Guide

Ce guide explique comment dÃ©marrer, configurer et sÃ©curiser un dÃ©mon Docker, avec ou sans accÃ¨s distant.

---

## ğŸ“¦ Lancer le service Docker

```bash
sudo systemctl start docker
sudo systemctl status docker
```

Alternativement, vous pouvez dÃ©marrer le dÃ©mon manuellement :

```bash
dockerd --debug
```

---

## ğŸ”Œ Connexion par dÃ©faut (Unix Socket)

Par dÃ©faut, le dÃ©mon Docker Ã©coute via une socket UnixÂ :

```
/var/run/docker.sock
```

Cela signifie que le **Docker CLI** communique avec le **Docker Daemon** via ce socket local. Il est donc uniquement accessible depuis la machine locale.

---

## ğŸŒ AccÃ¨s distant via TCP

Si vous voulez permettre l'accÃ¨s distant Ã  votre dÃ©mon Docker, vous pouvez utiliser une socket TCPÂ :

```bash
dockerd --debug \
  --host=tcp://<IP>:2375
```

âš ï¸ **Attention** : ouvrir le port `2375` sur Internet **est extrÃªmement dangereux** !
Ce port n'est **pas sÃ©curisÃ©**, **pas chiffrÃ©** et **ne nÃ©cessite aucune authentification**. Cela signifie que **n'importe qui peut exÃ©cuter des conteneurs** sur votre machine sâ€™il y accÃ¨de.

---

## ğŸ” Activer le chiffrement TLS (Port 2376)

Pour sÃ©curiser lâ€™accÃ¨s distant, utilisez TLS sur le port `2376` :

```bash
dockerd --debug \
  --host=tcp://<IP>:2376 \
  --tls=true \
  --tlscert=/path/to/server-cert.pem \
  --tlskey=/path/to/server-key.pem
```

ğŸ‘‰ **Astuce** : Vous pouvez dÃ©finir ces options dans le fichier de configuration :

**`/etc/docker/daemon.json`**

```json
{
  "hosts": ["tcp://0.0.0.0:2376", "unix:///var/run/docker.sock"],
  "tls": true,
  "tlscert": "/path/to/server-cert.pem",
  "tlskey": "/path/to/server-key.pem"
}
```

---

## ğŸ›¡ï¸ SÃ©curiser le Docker Daemon

Si quelquâ€™un accÃ¨de Ã  votre Docker Daemon non sÃ©curisÃ©, il pourraÂ :

* exÃ©cuter nâ€™importe quel conteneur,
* accÃ©der au systÃ¨me de fichiers de lâ€™hÃ´te,
* compromettre totalement votre machine.

---

## ğŸ”‘ Activer lâ€™authentification via TLS (TLSVerify)

âš ï¸ **Le chiffrement TLS seul nâ€™est pas suffisant**. Il ne fait que chiffrer les donnÃ©es.
Pour ajouter une **authentification mutuelle**, vous devez activer `tlsverify` et utiliser un **certificat d'autoritÃ© (CA)**.

### Exemple de commande cliente avec TLS et authentification :

```bash
export DOCKER_TLS_VERIFY=true
export DOCKER_HOST=tcp://<IP>:2376

docker \
  --tlscert=/path/to/client-cert.pem \
  --tlskey=/path/to/client-key.pem \
  --tlscacert=/path/to/ca.pem \
  ps
```

* `--tlscert` : certificat client
* `--tlskey` : clÃ© privÃ©e client
* `--tlscacert` : certificat de lâ€™autoritÃ© (CA)
* `DOCKER_TLS_VERIFY=true` : active la vÃ©rification et l'authentification TLS

---

## âœ… RÃ©sumÃ© : Bonnes pratiques

* ğŸ”’ **Nâ€™ouvrez jamais le port 2375** sans chiffrement.
* ğŸ” Utilisez TLS avec `--tlsverify` pour sÃ©curiser et authentifier lâ€™accÃ¨s.
* ğŸ§± Restreignez les IPs autorisÃ©es avec un firewall.
* ğŸ” Surveillez les logs du dÃ©mon Docker.
* ğŸ§° Utilisez le fichier `/etc/docker/daemon.json` pour gÃ©rer la configuration de maniÃ¨re persistante.

