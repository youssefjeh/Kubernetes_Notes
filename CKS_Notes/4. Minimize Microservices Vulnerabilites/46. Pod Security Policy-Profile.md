## ğŸ¯ **Câ€™est quoi lâ€™objectif ?**

**EmpÃªcher les pods dangereux de tourner** dans ton cluster Kubernetes.

Par exemple :
ğŸ‘‰ un pod qui utilise `root`,
ğŸ‘‰ un pod qui a accÃ¨s au systÃ¨me de fichiers de ton serveur,
ğŸ‘‰ un pod qui modifie des rÃ©glages du noyau...

Ce sont des **risques de sÃ©curitÃ©** !
Donc Kubernetes permet de **bloquer ce genre de pods.**

---

## ğŸ§± Il y avait deux faÃ§ons de faire Ã§a :

| Ancienne mÃ©thode                     | Nouvelle mÃ©thode               |
| ------------------------------------ | ------------------------------ |
| `PodSecurityPolicy` (PSP)            | `Pod Security Admission` (PSA) |
| Trop compliquÃ©e ğŸ˜µ                   | Simple Ã  utiliser ğŸ˜           |
| **SupprimÃ©e** depuis Kubernetes 1.25 | **UtilisÃ©e aujourd'hui**       |

---

## âœ… **On va donc apprendre PSA !**

---

## ğŸ›¡ï¸ PSA = des **rÃ¨gles de sÃ©curitÃ©** sur les namespaces

Un **namespace** câ€™est un dossier dans Kubernetes oÃ¹ tu mets des pods, des services, etc.

Avec PSA, tu peux dire :

> âŒ "Dans ce namespace, je ne veux **aucun pod dangereux**"

> âœ… "Je veux des **pods normaux** seulement"

---

## ğŸ‘®â€â™‚ï¸ Il existe 3 **niveaux de sÃ©curitÃ©**

| Nom du niveau | Ce que Ã§a veut dire                                |
| ------------- | -------------------------------------------------- |
| `privileged`  | Tout est autorisÃ© (dangereux) â—ï¸                   |
| `baseline`    | Un peu sÃ©curisÃ© ğŸ”                                 |
| `restricted`  | TrÃ¨s sÃ©curisÃ© (pas de root, pas de privilÃ¨ges) ğŸ›¡ï¸ |

ğŸ‘‰ En examen CKS, on te demande **souvent `restricted`**

---

## ğŸ“Œ Comment appliquer ces rÃ¨gles ?

### â¤ On utilise des **labels sur le namespace**

Exemple :

```bash
kubectl label namespace mon-namespace \
  pod-security.kubernetes.io/enforce=restricted \
  --overwrite
```

ğŸ‘‰ Cela veut dire : "je veux **bloquer** tous les pods qui ne respectent pas les rÃ¨gles `restricted`"

---

## ğŸ§ª Exemple trÃ¨s simple

### 1. Je crÃ©e un namespace :

```bash
kubectl create ns securite
```

### 2. Je mets une sÃ©curitÃ© forte (`restricted`) :

```bash
kubectl label ns securite \
  pod-security.kubernetes.io/enforce=restricted \
  --overwrite
```

### 3. Jâ€™essaie de crÃ©er un pod dangereux :

```bash
kubectl run test --image=nginx -n securite \
  --overrides='
{
  "apiVersion": "v1",
  "spec": {
    "securityContext": {
      "runAsUser": 0
    }
  }
}'
```

ğŸ‘‰ RÃ©sultat : âŒ **Erreur**
Tu vas voir : `Error from server (Forbidden)`
â¡ï¸ Le pod a Ã©tÃ© **bloquÃ©** par PSA.

---

## âœ… Exemple dâ€™un pod correct :

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-safe
spec:
  containers:
  - name: nginx
    image: nginx
  securityContext:
    runAsNonRoot: true
```

ğŸ“¦ Tu appliques ce pod dans le namespace `securite`, il passe âœ…

---

## ğŸ“ RÃ©sumÃ© pour ton examen CKS

| Ã‰tape                          | Commande                                                                           |
| ------------------------------ | ---------------------------------------------------------------------------------- |
| Voir les namespaces            | `kubectl get ns`                                                                   |
| Ajouter les rÃ¨gles de sÃ©curitÃ© | `kubectl label ns <nom> pod-security.kubernetes.io/enforce=restricted --overwrite` |
| Tester avec un pod root        | `runAsUser: 0` â†’ bloquÃ©                                                            |
| Tester avec un pod safe        | `runAsNonRoot: true` â†’ acceptÃ©                                                     |

---

