## ğŸ”§ Ã‰tape 1 : DÃ©finir les **ResourceQuota** pour Team A

### ğŸ“„ Fichier : `teama-rq.yml`

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: team-a-resource-quota
  namespace: team-a
spec:
  hard:
    pods: "5"
    requests.cpu: "0.5"
    requests.memory: "500Mi"
    limits.cpu: "1"
    limits.memory: "1Gi"
```

### âœ… Application de la configuration

```bash
kubectl apply -f teama-rq.yml
```

### ğŸ“Š VÃ©rification de l'Ã©tat de la quota

```bash
kubectl get resourcequotas -n team-a
```

---

## ğŸš€ Ã‰tape 2 : DÃ©ployer un Pod dans le namespace `team-a`

### ğŸ“„ Fichier : dÃ©ploiement inline avec `cat << EOF`

```bash
cat << EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  namespace: team-a
spec:
  containers:
  - name: app-container
    image: nginx
    ports:
    - containerPort: 80
    resources:
      requests:
        cpu: "0.1"
        memory: "10Mi"
      limits:
        cpu: "0.2"
        memory: "50Mi"
EOF
```

### ğŸ“Š VÃ©rification de l'utilisation des ressources

```bash
kubectl describe quota team-a-resource-quota -n team-a
```

**Sortie attendue :**

```
Resource         Used   Hard
--------         ----   ----
limits.cpu       200m   1
limits.memory    50Mi   1Gi
pods             1      5
requests.cpu     100m   500m
requests.memory  10Mi   500Mi
```

---

## ğŸ§© Ã‰tape 3 : DÃ©finir les **ResourceQuota** pour Team B

### ğŸ“„ Fichier : `teamb-rq.yml`

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: team-b-resource-quota
  namespace: team-b
spec:
  hard:
    pods: "3"
    requests.cpu: "0.5"
    requests.memory: "500Mi"
    limits.cpu: "2"
    limits.memory: "2Gi"
```

### âœ… Application de la configuration

```bash
kubectl apply -f teamb-rq.yml
```

---

## âŒ Ã‰tape 4 : DÃ©ploiement dâ€™un pod non conforme dans `team-b`

### ğŸ“„ Fichier : `~/team-b-app-pod.yaml`

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  namespace: team-b
spec:
  containers:
  - name: app-container
    image: nginx
    resources:
      requests:
        memory: "1Gi"
        cpu: "1"
      limits:
        memory: "2Gi"
        cpu: "2"
    ports:
    - containerPort: 80
```

### ğŸ§¨ Application et Ã©chec

```bash
kubectl apply -f ~/team-b-app-pod.yaml
```

**Erreur :**

```
Error from server (Forbidden): error when creating "team-b-app-pod.yaml":
pods "app-pod" is forbidden: exceeded quota: team-b-resource-quota,
requested: requests.cpu=1,requests.memory=1Gi,
used: requests.cpu=0,requests.memory=0,
limited: requests.cpu=500m,requests.memory=500Mi
```

---

## âœ… RÃ©sumÃ©

| Namespace | Quota Name              | Max Pods | CPU Req | Mem Req | CPU Limit | Mem Limit |
| --------- | ----------------------- | -------- | ------- | ------- | --------- | --------- |
| `team-a`  | `team-a-resource-quota` | 5        | 0.5     | 500Mi   | 1         | 1Gi       |
| `team-b`  | `team-b-resource-quota` | 3        | 0.5     | 500Mi   | 2         | 2Gi       |

Pour dÃ©ployer des pods avec succÃ¨s, les `requests` et `limits` doivent **impÃ©rativement respecter** les quotas dÃ©finis pour chaque namespace.


---
Super observation, et tu as **raison de creuser** ğŸ‘
Ã€ premiÃ¨re vue, **ton pod respecte bien `limits.cpu` (2)**, alors **pourquoi l'erreur ?**

â¡ï¸ RÃ©ponse : **lâ€™erreur ne vient pas des `limits`, elle vient des `requests`** â—

---

## ğŸ”¥ Replongeons dans lâ€™erreur exacte :

```bash
pods "app-pod" is forbidden: exceeded quota: team-b-resource-quota,
requested: requests.cpu=1, requests.memory=1Gi,
used: requests.cpu=0, requests.memory=0,
limited: requests.cpu=500m, requests.memory=500Mi
```

> âŒ **Lâ€™erreur est sur `requests.cpu` et `requests.memory`**, pas sur les `limits` !

---

## ğŸ¯ Ton pod demandait :

```yaml
requests:
  cpu: "1"        âŒ
  memory: "1Gi"   âŒ
limits:
  cpu: "2"        âœ…
  memory: "2Gi"   âœ…
```

Et dans ton **ResourceQuota** (team-b):

```yaml
requests.cpu: "0.5"      âœ… = 500m
requests.memory: "500Mi" âœ…
limits.cpu: "2"
limits.memory: "2Gi"
```

### ğŸŸ¥ Donc :

| Type         | Pod demande | Quota autorisÃ© | OK ? |
| ------------ | ----------- | -------------- | ---- |
| requests.cpu | **1**       | **0.5**        | âŒ    |
| requests.mem | **1Gi**     | **500Mi**      | âŒ    |
| limits.cpu   | 2           | 2              | âœ…    |
| limits.mem   | 2Gi         | 2Gi            | âœ…    |

---

## âœ… RÃ©sumÃ© clair :

> ğŸ‘‰ **Ton pod respecte les `limits`**, mais il **dÃ©passe les `requests`**
> â¤ Et **Kubernetes bloque la crÃ©ation dâ€™un pod si ses `requests` dÃ©passent la quota de `requests` du namespace**, mÃªme si les `limits` sont OK.

---

## ğŸ§  Pourquoi Kubernetes fait Ã§a ?

Parce que :

* `requests` = **rÃ©servation garantie** â†’ Kubernetes sâ€™assure de ne **pas sur-engager** les ressources du cluster.
* MÃªme si tu mets une `limit` de 2 CPU, si tu "rÃ©serves" 1 CPU (`request`), il faut que le cluster ait assez de marge selon les quotas.

